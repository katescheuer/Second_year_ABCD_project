---
title: "Stress-related PRS"
output: html_document
date: "2024-02-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

setwd("C:/Users/Kate Scheuer/OneDrive - UW/Desktop/Lab/Second_year_ABCD_project/Working")

```

### Import data, load libraries

```{r import data, load libraries, echo=FALSE}

### load libraries ####
library(readxl)
library(tidyverse)
library(GENESIS)
library(lme4)
library(Matrix)
library(misty)
library(lmerTest)
library(moments)
library(robustlmm)

### avoid scientific notation ####
options(scipen=999) ## forces full display of results, all digits
# to change it back to scientific notation, use: options(scipen=0)


### import data ####

## ABCD data
demo <- read.csv("abcd_p_demo.csv",header=T) # demographics
meta <- read.csv("abcd_y_lt.csv",header=T) #site id, interview age
cbcl <- read.csv("mh_p_cbcl.csv",header=T) # cbcl
ksads_lifetime <- read.csv("ABCD_Baseline_T1_T2_T3_T4_KSADS_Lifetime_Diagnoses.csv") #lifetime ksads diagnoses

## federal poverty data from https://aspe.hhs.gov/topics/poverty-economic-mobility/poverty-guidelines
poverty_info <- read.csv("federal_poverty_info.csv",header=T)

## PRS 
prs_stress <- read.table("StressPRS_w_MHC.profile",header=T) #include all snps in mhc
prs_mdd <- read.table("MDD_PRS.profile",header=T)

## genetic relatedness matrices (GRMs)
all_grm <- readRDS(file = "ABCD_All_PCRel_grm_sparse.rda") # all ancestries
afr_grm <- readRDS(file = "ABCD_Afr_PCRel_grm_sparse.rda") # african ancestry
amadmix_grm <- readRDS(file = "ABCD_AmerAdmix_PCRel_grm_sparse.rda") # american admixed ancestry
eur_grm <- readRDS(file = "ABCD_Eur_PCRel_grm_sparse.rda") # european ancestry

## ancestry groupings
afr_gp <- read_xlsx("ABCD_RF_Afr_Grouping.xlsx")
amadmix_gp <- read_xlsx("ABCD_RF_AmerAdmix_Grouping.xlsx")
eur_gp <- read_xlsx("ABCD_RF_Eur_Grouping.xlsx")

```

### Group all like files into one data frame each, basic data cleaning

```{r group data, echo=FALSE}

### calculate income to needs ratio
income_df <- demo %>%
              select(c("src_subject_id","eventname",
                       "demo_roster_v2","demo_roster_v2_l",
                       "demo_roster_v2_refuse","demo_roster_v2_refuse_l",
                       "demo_comb_income_v2","demo_comb_income_v2_l")) %>%
              # combine items for income from baseline to yr 2 and yr 3+
              mutate(income_category = case_when(!is.na(demo_comb_income_v2) ~ demo_comb_income_v2,
                                        !is.na(demo_comb_income_v2_l) ~ demo_comb_income_v2_l
                                  )) %>%
              # for income replace 777 and 999 with NA
              mutate(income_category = ifelse(income_category %in% 
                                                c(777,999) , NA, income_category)) %>%
              # add column for middle value of income category (or upper for 10)
              mutate(income_val = case_when(income_category == 1 ~ 2499.5, # less than 5,000
                                            income_category == 2 ~ 8499.5, # 5,000 to 11,999
                                            income_category == 3 ~ 13999.5, # 12,000 to 15,999
                                            income_category == 4 ~ 20499.5, # 16,000 to 24,999
                                            income_category == 5 ~ 29999.5, # 25,000 to 34,999
                                            income_category == 6 ~ 42499.5, # 35,000 to 49,999
                                            income_category == 7 ~ 62499.5, # 50,000 to 74,999
                                            income_category == 8 ~ 87499.5, # 75,000 to 99,999
                                            income_category == 9 ~ 149999.5, # 100,000 to 199,999
                                            income_category == 10 ~ 200000 # 200,000 and greater
                                  )) %>%
              # combine items for household size from baseline to yr 2 and yr 3+
              mutate(household_size = case_when(demo_roster_v2_refuse %in% c(777,999) ~ NA,
                                                demo_roster_v2_refuse_l %in% c(777,999) ~ NA,
                                        !is.na(demo_roster_v2) ~ demo_roster_v2,
                                        !is.na(demo_roster_v2_l) ~ demo_roster_v2_l
                                  )) %>%
              # for household size replace unreasonable values with NA
              mutate(household_size = ifelse(household_size %in% 
                              c(-4, 0, 41, 43, 56, 60, 77, 110, 2300) , NA, household_size)) %>%
              # add year data was collected
              left_join(select(meta,c("src_subject_id","eventname","interview_date")),
                                    by=c("src_subject_id","eventname")) %>%
              mutate(year = as.integer(gsub("^.{1,6}","",interview_date))) %>%
              # add federal poverty line for given year and household size
              left_join(poverty_info,by=c("household_size","year")) %>%
              # calculate income to needs ratio
              mutate(income_to_needs = income_val/poverty_line)


## group all abcd data ####  
abcd_all <- demo %>%
              select(c("src_subject_id","eventname","demo_sex_v2",
                       "demo_gender_id_v2","demo_gender_id_v2_l")) %>%
              # to copy sex (asked only at baseline) to other years
              group_by(src_subject_id) %>%
              mutate(sex = first(demo_sex_v2)) %>%
              ungroup() %>%
              # only 12 subjects are intersex which is too small to analyze
              # so set to NA
              mutate(sex = if_else(sex==3,NA,sex)) %>%
              # make sex factor
              mutate(sex = as.factor(sex)) %>%
              # combine items for gender from baseline to yr 2 and yr 3+
              mutate(gender = case_when(!is.na(demo_gender_id_v2) ~ demo_gender_id_v2,
                                        !is.na(demo_gender_id_v2_l) ~ demo_gender_id_v2_l
                                  )) %>%
              # for gender replace 777 and 999 with NA
              mutate(gender = ifelse(gender %in% c(777,999) , NA, gender)) %>%
              # for gender combine 3 (trans male), 4 (trans female), 5 (genderqueer), and 6 (other) into one gender diverse group
              mutate(gender = if_else(c(gender==3|gender==4|gender==5|gender==6),3,gender)) %>%
              # make gender factor
              mutate(gender = as.factor(gender)) %>%
              # add income to needs ratio
              left_join(income_df,by=c("src_subject_id","eventname")) %>%
              # add site and interview age
              left_join(select(meta,
                               c("src_subject_id","eventname",
                                 "site_id_l","interview_age")),
                        by=c("src_subject_id","eventname")) %>%
              rename(site = site_id_l,
                     age = interview_age) %>%
              # add cbcl scores
              left_join(select(cbcl,
                               c("src_subject_id","eventname",
                                 "cbcl_scr_syn_aggressive_t","cbcl_scr_syn_attention_t",
                                 "cbcl_scr_syn_anxdep_t","cbcl_scr_syn_external_t",
                                 "cbcl_scr_syn_internal_t","cbcl_scr_syn_rulebreak_t",
                                 "cbcl_scr_syn_social_t","cbcl_scr_syn_somatic_t",
                                 "cbcl_scr_syn_thought_t","cbcl_scr_syn_totprob_t",
                                 "cbcl_scr_syn_withdep_t")),
                        by=c("src_subject_id","eventname")) %>%
              rename(cbcl_agg = cbcl_scr_syn_aggressive_t,
                     cbcl_attn = cbcl_scr_syn_attention_t,
                     cbcl_anxdep = cbcl_scr_syn_anxdep_t,
                     cbcl_ext = cbcl_scr_syn_external_t,
                     cbcl_int = cbcl_scr_syn_internal_t,
                     cbcl_rule = cbcl_scr_syn_rulebreak_t,
                     cbcl_social = cbcl_scr_syn_social_t,
                     cbcl_somatic = cbcl_scr_syn_somatic_t,
                     cbcl_thought = cbcl_scr_syn_thought_t,
                     cbcl_total = cbcl_scr_syn_totprob_t,
                     cbcl_withdep = cbcl_scr_syn_withdep_t) %>%
              # add lifetime ksads scores
              left_join(select(ksads_lifetime,
                               c("src_subject_id","eventname",
                                 "lifetime_adhd","umbrella_anxiety_disorder",
                                 "lifetime_mdd","lifetime_ptsd")),
                        by=c("src_subject_id","eventname")) %>%
              rename(adhd = lifetime_adhd,
                     anxiety = umbrella_anxiety_disorder,
                     mdd = lifetime_mdd,
                     ptsd = lifetime_ptsd)
              

## group all prs data ####
prs_all <- prs_stress %>%
            #rename stress prs column to indicate score is for stress
            rename(prs_stress = SCORESUM) %>%
            select(IID,prs_stress) %>%
            left_join(select(prs_mdd,c("IID","SCORESUM")),
                      by=c("IID")) %>%
            rename(prs_mdd = SCORESUM) %>%
            #remove first 10 char so subject id as in abcd
            mutate(src_subject_id = gsub("^.{1,10}", "", IID)) %>%
            select(c(src_subject_id,prs_stress,prs_mdd))

## make categorical ancestry groups ####
afr_gp <- afr_gp %>% mutate(ancestry="Afr")
amadmix_gp <- amadmix_gp %>% mutate(ancestry="AmAdmix")
eur_gp <- eur_gp %>% mutate(ancestry="Eur")
ancestry_gp_all <- bind_rows(afr_gp,amadmix_gp,eur_gp) %>%
                      select("subjectkey","ancestry","V1","V2","V3","V4","V5","V6","V7","V8") %>%
                      rename(src_subject_id = subjectkey)

# rename grms so names are consistent with abcd names
#if remove first 10 char from rownames in grm then = subject id
rownames(all_grm) <- gsub("^.{1,10}","",rownames(all_grm)) 
colnames(all_grm) <- gsub("^.{1,10}","",colnames(all_grm))
rownames(afr_grm) <- gsub("^.{1,10}","",rownames(afr_grm))
colnames(afr_grm) <- gsub("^.{1,10}","",colnames(afr_grm))
rownames(amadmix_grm) <- gsub("^.{1,10}","",rownames(amadmix_grm))
colnames(amadmix_grm) <- gsub("^.{1,10}","",colnames(amadmix_grm))
rownames(eur_grm) <- gsub("^.{1,10}","",rownames(eur_grm))
colnames(eur_grm) <- gsub("^.{1,10}","",colnames(eur_grm))

### combine all data except grms ####
data_all <- abcd_all %>%
              left_join(prs_all, by="src_subject_id") %>%
              left_join(ancestry_gp_all, by="src_subject_id") %>%
              #remove subjects without ancestry information
              filter(!is.na(ancestry)) %>%
              #Z-score  PRS based on ancestry
              group_by(ancestry) %>%
              mutate(Zprs_stress = as.numeric(scale(prs_stress, scale=TRUE))) %>%
              group_by(ancestry) %>%
              mutate(Zprs_mdd = as.numeric(scale(prs_mdd, scale=TRUE))) %>%
              #keep only relevant columns
              select(c(src_subject_id,eventname,site,ancestry,
                       sex,gender,income_to_needs,age,
                       Zprs_stress,Zprs_mdd,
                       cbcl_total,cbcl_ext,cbcl_int,
                       cbcl_agg,cbcl_attn,cbcl_anxdep,
                       cbcl_rule,cbcl_social,cbcl_somatic,
                       cbcl_thought,cbcl_withdep,
                       adhd,anxiety,mdd,ptsd,
                       V1,V2,V3,V4,V5,V6,V7,V8
                       )) %>%
              #remove rows with NA in any column
              drop_na()

### dummy coding, effect coding, cluster mean centering
data_all <- data_all %>%
            #dummy coding
            mutate(sex_dum_f = case_when(sex == 1 ~ 0, #male as ref category
                                         sex == 2 ~ 1)) %>% #female
            mutate(gender_dum_cisf = case_when(gender == 1 ~ 0, #cis male as ref category
                                               gender == 2 ~ 1, #cis female
                                               gender == 3 ~ 0)) %>% # gender diverse
            mutate(gender_dum_gd = case_when(gender == 1 ~ 0, #cis male as ref category
                                             gender == 2 ~ 0, #cis female
                                             gender == 3 ~ 1)) %>% # gender diverse
            #effect coding - different betas but same pvals
            mutate(sex_eff_cisf = case_when(sex == 1 ~ -1, #male
                                            sex == 2 ~ 1)) %>% #female
            mutate(gender_eff_cisf = case_when(gender == 1 ~ -1, #cis male
                                               gender == 2 ~ 1, #cis female
                                               gender == 3 ~ 0)) %>% # gender diverse
            mutate(gender_eff_gd = case_when(gender == 1 ~ -1, #cis male 
                                             gender == 2 ~ 0, #cis female
                                             gender == 3 ~ 1)) %>% # gender diverse
            #cluster mean centering - slightly different betas and pvals
            mutate(sex_cmc_cisf = as.numeric(center(sex_eff_cisf, 
                             type="CWC", cluster = site))) %>%
            mutate(gender_cmc_cisf = as.numeric(center(gender_eff_cisf, 
                             type="CWC", cluster = site))) %>%
            mutate(gender_cmc_gd = as.numeric(center(gender_eff_gd, 
                             type="CWC", cluster = site))) %>%
            mutate(Zprs_stress_cmc = as.numeric(center(Zprs_stress,type="CWC",cluster=site))) %>%
            mutate(Zprs_mdd_cmc = as.numeric(center(Zprs_mdd,type="CWC",cluster=site))) %>%
            mutate(age_cmc = as.numeric(center(age,type="CWC",cluster=site))) %>%
            #Z score continuous variables (already done for prs by ancestry)
            mutate(age_zcmc = as.numeric(scale(age_cmc, scale=TRUE)))




```

### Separate data based on collection date

``` {separate data based on collection date, r}

baseline_data <- data_all %>% filter(eventname == "baseline_year_1_arm_1")
yr1_data <- data_all %>% filter(eventname == "1_year_follow_up_y_arm_1")
yr2_data <- data_all %>% filter(eventname == "2_year_follow_up_y_arm_1")
yr3_data <- data_all %>% filter(eventname == "3_year_follow_up_y_arm_1")
yr4_data <- data_all %>% filter(eventname == "4_year_follow_up_y_arm_1")

```

### Reorder data so matches grm

```{reorder data so matches grm, r}

### All ancestries ####
all_grm_for_yr <- all_grm[which(rownames(all_grm) %in% yr4_data$src_subject_id),]
all_grm_for_yr <- all_grm_for_yr[,which(colnames(all_grm_for_yr) %in% yr4_data$src_subject_id)]
row_indices_All <- match(yr4_data$src_subject_id,rownames(all_grm_for_yr)) 
all_grm_sparse_subsetted <- all_grm_for_yr[row_indices_All, row_indices_All]
all_yr4_data_reordered <- yr4_data[match(colnames(all_grm_sparse_subsetted),yr4_data$src_subject_id),]
all_yr4_data_reordered <- all_yr4_data_reordered %>% column_to_rownames(var="src_subject_id")

### African ancestry ####
afr_grm_for_yr <- afr_grm[which(rownames(afr_grm) %in% yr4_data$src_subject_id),]
afr_grm_for_yr <- afr_grm_for_yr[,which(colnames(afr_grm_for_yr) %in% yr4_data$src_subject_id)]
row_indices_All <- match(yr4_data$src_subject_id,rownames(afr_grm_for_yr)) 
afr_yr4_data <- yr4_data %>% filter(ancestry=="Afr")
row_indices_All <- match(afr_yr4_data$src_subject_id,rownames(afr_grm_for_yr))
afr_grm_sparse_subsetted <- afr_grm_for_yr[row_indices_All, row_indices_All]
afr_yr4_data_reordered <- afr_yr4_data[match(colnames(afr_grm_sparse_subsetted),
                                                       afr_yr4_data$src_subject_id),]
afr_yr4_data_reordered <- afr_yr4_data_reordered %>% column_to_rownames(var="src_subject_id")

### American admixed ancestry ####
amadmix_grm_for_yr <- amadmix_grm[which(rownames(amadmix_grm) %in% yr4_data$src_subject_id),]
amadmix_grm_for_yr <- amadmix_grm_for_yr[,which(colnames(amadmix_grm_for_yr) %in% yr4_data$src_subject_id)]
row_indices_All <- match(yr4_data$src_subject_id,rownames(amadmix_grm_for_yr)) 
amadmix_yr4_data <- yr4_data %>% filter(ancestry=="AmAdmix")
row_indices_All <- match(amadmix_yr4_data$src_subject_id,rownames(amadmix_grm_for_yr))
amadmix_grm_sparse_subsetted <- amadmix_grm_for_yr[row_indices_All, row_indices_All]
amadmix_yr4_data_reordered <- amadmix_yr4_data[match(colnames(amadmix_grm_sparse_subsetted),
                                                               amadmix_yr4_data$src_subject_id),]
amadmix_yr4_data_reordered <- amadmix_yr4_data_reordered %>% column_to_rownames(var="src_subject_id")

### European ancestry ####
eur_grm_for_yr <- eur_grm[which(rownames(eur_grm) %in% yr4_data$src_subject_id),]
eur_grm_for_yr <- eur_grm_for_yr[,which(colnames(eur_grm_for_yr) %in% yr4_data$src_subject_id)]
eur_yr4_data <- yr4_data %>% filter(ancestry=="Eur")
row_indices_All <- match(eur_yr4_data$src_subject_id,rownames(eur_grm_for_yr))
eur_grm_sparse_subsetted <- eur_grm_for_yr[row_indices_All, row_indices_All]
eur_yr4_data_reordered <- eur_yr4_data[match(colnames(eur_grm_sparse_subsetted),
                                                       eur_yr4_data$src_subject_id),]
eur_yr4_data_reordered <- eur_yr4_data_reordered %>% column_to_rownames(var="src_subject_id")

```

### Make matrices for site

``` {make matrices for site, r}

#for all ancestries, make true/false covariance matrix for site
all_site_covmat_string <- outer(all_yr4_data_reordered$site, all_yr4_data_reordered$site, "==")
all_site_covmat <- apply(all_site_covmat_string, 2, as.numeric)
dimnames(all_site_covmat) <- dimnames(all_grm_sparse_subsetted)

#for eur ancestry, make true/false covariance matrix for site
eur_site_covmat_string <- outer(eur_yr4_data_reordered$site, eur_yr4_data_reordered$site, "==")
eur_site_covmat <- apply(eur_site_covmat_string, 2, as.numeric)
dimnames(eur_site_covmat) <- dimnames(eur_grm_sparse_subsetted)

#for afr ancestry, make true/false covariance matrix for site
afr_site_covmat_string <- outer(afr_yr4_data_reordered$site, afr_yr4_data_reordered$site, "==")
afr_site_covmat <- apply(afr_site_covmat_string, 2, as.numeric)
dimnames(afr_site_covmat) <- dimnames(afr_grm_sparse_subsetted)

#for amadmix ancestry, make true/false covariance matrix for site
amadmix_site_covmat_string <- outer(amadmix_yr4_data_reordered$site, 
                                    amadmix_yr4_data_reordered$site, "==")
amadmix_site_covmat <- apply(amadmix_site_covmat_string, 2, as.numeric)
dimnames(amadmix_site_covmat) <- dimnames(amadmix_grm_sparse_subsetted)

```

### Stress PRS, eur ancestry: cbcl or ksads ~ stress prs + sex + age + ancestry PCs

``` {stress PRS, eur ancestry: cbcl or ksads ~ stress prs + sex + age + ancestry PCs, r}

lm_eur_stressprs_total <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_total", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_ext <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_ext", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_int <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_int", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_agg <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_agg", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_attn <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_attn", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_anxdep <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_anxdep", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_rule <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_rule", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_social <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_social", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_somatic <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_somatic", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_thought <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_thought", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_stressprs_withdep <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_withdep", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)

lm_eur_stressprs_adhd <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "adhd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_eur_stressprs_anxiety <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "anxiety", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_eur_stressprs_mdd <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "mdd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_eur_stressprs_ptsd <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "ptsd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_stress_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)

### see fixed effect results
round(lm_eur_stressprs_total$fixef,10)
round(lm_eur_stressprs_ext$fixef,10)
round(lm_eur_stressprs_int$fixef,10)
round(lm_eur_stressprs_agg$fixef,10)
round(lm_eur_stressprs_attn$fixef,10)
round(lm_eur_stressprs_anxdep$fixef,10)
round(lm_eur_stressprs_rule$fixef,10)
round(lm_eur_stressprs_social$fixef,10)
round(lm_eur_stressprs_somatic$fixef,10)
round(lm_eur_stressprs_thought$fixef,10)
round(lm_eur_stressprs_withdep$fixef,10)
round(lm_eur_stressprs_adhd$fixef,10) #98 cases (66 male, 32 female or 67 cis male, 24 cis female, 5 gender diverse), 2201 controls
round(lm_eur_stressprs_anxiety$fixef,10) #387 cases (146 male, 241 female or 148 cis male, 203 cis female, 36 gender diverse), 1912 controls
round(lm_eur_stressprs_mdd$fixef,10) #249 cases (80 male, 169 female or 79 cis male, 147 cis female, 33 gender diverse), 2050 controls
round(lm_eur_stressprs_ptsd$fixef,10) #56 cases (23 male, 33 female or 22 cis male, 28 cis female, 6 gender diverse), 2243 controls

### AIC for sex vs gender ####
# sex: 1226 male vs 1073 female
# gender: 1217 cis male vs 1012 cis female vs 70 gender diverse
#total: 17392.1 vs 17352.28 - choose gender
#ext: 16580.36 vs 16561.91 - choose gender
#int: 17234.33 vs 17205.02 - choose gender
#agg: 13049.22 vs 13039.58 - choose gender
#attn: 14372.35 vs 14331.75 - choose gender
#anxdep: 14679.36 vs 14658.46 - choose gender
#rule: 12414.87 vs 12401.4 - choose gender
#social: 13463.93 vs 13457.95 - choose gender
#somatic: 14493.42 vs 14472.28 - choose gender
#thought: 14596.28 vs 14521.77 - choose gender
#withdep: 14844.43 vs 14800.39 - choose gender
#adhd: 12974.91 vs 13143.02 - choose sex
#anxiety: 11112.35 vs 11138.76 - choose sex
#mdd: 12095.32 vs 12205.17 - choose sex
#ptsd: 13791.07 vs 13772.39 - choose gender

lm_eur_stressprs_total$AIC
lm_eur_stressprs_ext$AIC
lm_eur_stressprs_int$AIC
lm_eur_stressprs_agg$AIC
lm_eur_stressprs_attn$AIC
lm_eur_stressprs_anxdep$AIC
lm_eur_stressprs_rule$AIC
lm_eur_stressprs_social$AIC
lm_eur_stressprs_somatic$AIC
lm_eur_stressprs_thought$AIC
lm_eur_stressprs_withdep$AIC
lm_eur_stressprs_adhd$AIC
lm_eur_stressprs_anxiety$AIC
lm_eur_stressprs_mdd$AIC
lm_eur_stressprs_ptsd$AIC

### Results ####
#total: no sig
#ext: no sig
#int: sex: beta = 0.999, se = 0.225, p = 0.00000905
#agg: sex: beta = -0.258, se = 0.091, p = 0.004
#attn: no sig
#anxdep: sex: beta = 0.487, se = 0.128, p = 0.000145
#rule: no sig
#social: no sig
#***somatic: prs: beta = 0.281, se = 0.122, p = 0.022; sex: beta = 0.396, se = 0.123, p = 0.00123
#thought: sex: beta = 0.269, se = 0.128, p = 0.035
#withdep: no sig
#adhd: sex: beta = -0.329, se = 0.113, p = 0.004
#anxiety: sex: beta = 0.394, se = 0.059, p = < 0.0000000001; age: beta = 0.369, se = 0.132, p = 0.005
#mdd: sex: beta = 0.490, se = 0.073, p < 0.0000000001
#ptsd: no sig


### adjusted p-values for PRS only
p.adjust(c(
           # lm_eur_stressprs_total$fixef$pval[2], #not sig
           # lm_eur_stressprs_ext$fixef$pval[2], #not sig
           # lm_eur_stressprs_int$fixef$pval[2], #not sig
           lm_eur_stressprs_agg$fixef$pval[2], #not sig
           lm_eur_stressprs_attn$fixef$pval[2], #not sig
           lm_eur_stressprs_anxdep$fixef$pval[2], #not sig
           lm_eur_stressprs_rule$fixef$pval[2], #not sig
           lm_eur_stressprs_social$fixef$pval[2], #not sig
           lm_eur_stressprs_somatic$fixef$pval[2], #not sig
           lm_eur_stressprs_thought$fixef$pval[2], #not sig
           lm_eur_stressprs_withdep$fixef$pval[2], #not sig
           lm_eur_stressprs_adhd$fixef$pval[2], #not sig
           lm_eur_stressprs_anxiety$fixef$pval[2], #not sig
           lm_eur_stressprs_mdd$fixef$pval[2], #not sig
           lm_eur_stressprs_ptsd$fixef$pval[2]), #not sig
           method="fdr")

### adjusted p-values for sex only
p.adjust(c(
           # lm_eur_stressprs_total$fixef$pval[3], #not sig
           # lm_eur_stressprs_ext$fixef$pval[3], #not sig
           # lm_eur_stressprs_int$fixef$pval[3], #***sig
           lm_eur_stressprs_agg$fixef$pval[3], #***sig
           lm_eur_stressprs_attn$fixef$pval[3], #not sig
           lm_eur_stressprs_anxdep$fixef$pval[3], #***sig
           lm_eur_stressprs_rule$fixef$pval[3], #not sig
           lm_eur_stressprs_social$fixef$pval[3], #not sig
           lm_eur_stressprs_somatic$fixef$pval[3], #***sig
           lm_eur_stressprs_thought$fixef$pval[3], #not sig
           lm_eur_stressprs_withdep$fixef$pval[3], #not sig
           lm_eur_stressprs_adhd$fixef$pval[3], #***sig
           lm_eur_stressprs_anxiety$fixef$pval[3], #***sig
           lm_eur_stressprs_mdd$fixef$pval[3], #***sig
           lm_eur_stressprs_ptsd$fixef$pval[3]), #not sig
           method="fdr")

```


### MDD PRS, eur ancestry: cbcl or ksads ~ mdd prs + sex + age + ancestry PCs

``` {mdd PRS, eur ancestry: cbcl or ksads ~ mdd prs + sex + age + ancestry PCs, r}

lm_eur_mddprs_total <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_total", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_ext <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_ext", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_int <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_int", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_agg <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_agg", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_attn <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_attn", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_anxdep <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_anxdep", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_rule <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_rule", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_social <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_social", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_somatic <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_somatic", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_thought <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_thought", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_eur_mddprs_withdep <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "cbcl_withdep", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)

lm_eur_mddprs_adhd <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "adhd", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_eur_mddprs_anxiety <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "anxiety", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_eur_mddprs_mdd <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "mdd", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_eur_mddprs_ptsd <- fitNullModel(eur_yr4_data_reordered, 
                                  outcome = "ptsd", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  # covars = c("Zprs_mdd_cmc", "gender_eff_cisf", "gender_eff_gd","age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = eur_grm_sparse_subsetted,
                                                 site = eur_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)

### see fixed effect results
round(lm_eur_mddprs_total$fixef,10)
round(lm_eur_mddprs_ext$fixef,10)
round(lm_eur_mddprs_int$fixef,10)
round(lm_eur_mddprs_agg$fixef,10)
round(lm_eur_mddprs_attn$fixef,10)
round(lm_eur_mddprs_anxdep$fixef,10)
round(lm_eur_mddprs_rule$fixef,10)
round(lm_eur_mddprs_social$fixef,10)
round(lm_eur_mddprs_somatic$fixef,10)
round(lm_eur_mddprs_thought$fixef,10)
round(lm_eur_mddprs_withdep$fixef,10)
round(lm_eur_mddprs_adhd$fixef,10) #98 cases (66 male, 32 female or 67 cis male, 24 cis female, 5 gender diverse), 2201 controls
round(lm_eur_mddprs_anxiety$fixef,10) #387 cases (146 male, 241 female or 148 cis male, 203 cis female, 36 gender diverse), 1912 controls
round(lm_eur_mddprs_mdd$fixef,10) #249 cases (80 male, 169 female or 79 cis male, 147 cis female, 33 gender diverse), 2050 controls
round(lm_eur_mddprs_ptsd$fixef,10) #56 cases (23 male, 33 female or 22 cis male, 28 cis female, 6 gender diverse), 2243 controls

### AIC for sex vs gender ####
# sex: 1226 male vs 1073 female
# gender: 1217 cis male vs 1012 cis female vs 70 gender diverse
#total: 17370.49 vs 17331.33 - choose gender
#ext: 16564.43 vs 16546.28 - choose gender
#int: 17221.7 vs 17193.15 - choose gender
#agg: 13041.36 vs 13031.91 - choose gender
#attn:  14353.46 vs 14313.37 - choose gender
#anxdep: 14672.26 vs 14651.92 - choose gender
#rule: 12403.43 vs 12390.41 - choose gender
#social: 13458.83 vs  13453.14 - choose gender
#somatic: 14492.06 vs 14471.7 - choose gender
#thought: 14581.78 vs 14508.42 - choose gender
#withdep: 14832.19 vs 14788.71 - choose gender
#adhd: 12974.78 vs 13142.05 - choose sex
#anxiety: 11106.98 vs 11128.28 - choose sex
#mdd: 12138.38 vs 12215.82 - choose gender
#ptsd: 13702.05 vs 13717.91 - choose sex

lm_eur_mddprs_total$AIC
lm_eur_mddprs_ext$AIC
lm_eur_mddprs_int$AIC
lm_eur_mddprs_agg$AIC
lm_eur_mddprs_attn$AIC
lm_eur_mddprs_anxdep$AIC
lm_eur_mddprs_rule$AIC
lm_eur_mddprs_social$AIC
lm_eur_mddprs_somatic$AIC
lm_eur_mddprs_thought$AIC
lm_eur_mddprs_withdep$AIC
lm_eur_mddprs_adhd$AIC
lm_eur_mddprs_anxiety$AIC
lm_eur_mddprs_mdd$AIC
lm_eur_mddprs_ptsd$AIC

### Results ####
#***total: prs: beta = 1.108, se = 0.238, p = 0.00000320; sex: beta = 0.462, se = 0.234, p = 0.048
#***ext: prs: beta = 0.794, se = 0.198, p = 0.0000624
#***int: prs: beta = 0.836, se = 0.228, p = 0.000242; sex: beta = 1.019, se = 0.224, p = 0.00000566
#***agg: prs: beta = 0.257, se = 0.092, p = 0.00503; sex: beta = -0.252, se = 0.090, p = 0.00534
#***attn: prs: beta = 0.531, se = 0.122, p = 0.0000130
#***anxdep: prs: beta = 0.372, se = 0.130, p = 0.00410; sex: beta = 0.497, se = 0.128, p = 0.000104
#***rule: prs: beta = 0.280, se = 0.081, p = 0.000550
#***social: prs: beta = 0.255, se = 0.100, p = 0.011
#***somatic: prs: beta = 0.320, se = 0.124, p = 0.010; sex: beta = 0.406, se = 0.123, p = 0.000930
#***thought: prs: beta = 0.542, se = 0.129, p = 0.0000268; sex: beta = 0.282, se = 0.127, p = 0.027
#***withdep: prs: beta = 0.476, se = 0.135, p = 0.000441
#adhd: sex: beta = -0.329, se = 0.113, p = 0.00360
#***anxiety: prs: beta = 0.174, se = 0.059, p = 0.00296; sex: beta = 0.399, se = 0.059, p < 0.0000000001; age: beta = 0.359, se = 0.132, p = 0.00637
#***mdd: prs: beta = 0.211, se = 0.070, p = 0.00274; sex: beta = 0.496, se = 0.073, p < 0.0000000001
#ptsd: no sig



```


### Stress PRS, afr ancestry: cbcl or ksads ~ stress prs + sex + age + ancestry PCs

``` {stress PRS, afr ancestry: cbcl or ksads ~ stress prs + sex + age + ancestry PCs, r}

lm_afr_stressprs_total <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_total", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_ext <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_ext", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_int <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_int", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_agg <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_agg", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_attn <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_attn", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_anxdep <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_anxdep", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_rule <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_rule", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_social <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_social", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_somatic <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_somatic", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_thought <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_thought", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_stressprs_withdep <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_withdep", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)

lm_afr_stressprs_adhd <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "adhd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_afr_stressprs_anxiety <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "anxiety", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_afr_stressprs_mdd <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "mdd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_afr_stressprs_ptsd <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "ptsd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)

### see fixed effect results
round(lm_afr_stressprs_total$fixef,10)
round(lm_afr_stressprs_ext$fixef,10)
round(lm_afr_stressprs_int$fixef,10)
round(lm_afr_stressprs_agg$fixef,10)
round(lm_afr_stressprs_attn$fixef,10)
round(lm_afr_stressprs_anxdep$fixef,10)
round(lm_afr_stressprs_rule$fixef,10)
round(lm_afr_stressprs_social$fixef,10)
round(lm_afr_stressprs_somatic$fixef,10)
round(lm_afr_stressprs_thought$fixef,10)
round(lm_afr_stressprs_withdep$fixef,10)
round(lm_afr_stressprs_adhd$fixef,10) #18 cases, 499 controls
round(lm_afr_stressprs_anxiety$fixef,10) #46 cases, 471 controls
round(lm_afr_stressprs_mdd$fixef,10) #53 cases, 464 controls
round(lm_afr_stressprs_ptsd$fixef,10) #10 cases, 507 controls

### AIC for sex vs gender
# sex: 249 male vs 268 female
# gender: 250 cis male vs 264 cis female vs 3 gender diverse (not enough to use)

### Results
#total: no sig
#ext: no sig
#int: no sig
#agg: no sig
#attn: no sig
#anxdep: no sig
#rule: no sig
#social: no sig
#somatic: no sig
#thought: no sig
#withdep: no sig
#adhd: no sig
#anxiety: no sig
#mdd: sex: beta = 0.368, se = 0.164, p = 0.025
#ptsd: no sig

### adjusted p-values for sex only
p.adjust(c(
           # lm_afr_stressprs_total$fixef$pval[3], #not sig
           # lm_afr_stressprs_ext$fixef$pval[3], #not sig
           # lm_afr_stressprs_int$fixef$pval[3], #not sig
           lm_afr_stressprs_agg$fixef$pval[3], #not sig
           lm_afr_stressprs_attn$fixef$pval[3], #not sig
           lm_afr_stressprs_anxdep$fixef$pval[3], #not sig
           lm_afr_stressprs_rule$fixef$pval[3], #not sig
           lm_afr_stressprs_social$fixef$pval[3], #not sig
           lm_afr_stressprs_somatic$fixef$pval[3], #not sig
           lm_afr_stressprs_thought$fixef$pval[3], #not sig
           lm_afr_stressprs_withdep$fixef$pval[3], #not sig
           lm_afr_stressprs_adhd$fixef$pval[3], #not sig
           lm_afr_stressprs_anxiety$fixef$pval[3], #not sig
           lm_afr_stressprs_mdd$fixef$pval[3], #not sig
           lm_afr_stressprs_ptsd$fixef$pval[3]), #not sig
           method="fdr")

```


### MDD PRS, afr ancestry: cbcl or ksads ~ mdd prs + sex + age + ancestry PCs

``` {mdd PRS, afr ancestry: cbcl or ksads ~ mdd prs + sex + age + ancestry PCs, r}

lm_afr_mddprs_total <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_total", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_ext <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_ext", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_int <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_int", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_agg <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_agg", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_attn <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_attn", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_anxdep <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_anxdep", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_rule <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_rule", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_social <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_social", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_somatic <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_somatic", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_thought <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_thought", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_afr_mddprs_withdep <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "cbcl_withdep", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)

lm_afr_mddprs_adhd <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "adhd", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_afr_mddprs_anxiety <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "anxiety", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_afr_mddprs_mdd <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "mdd", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_afr_mddprs_ptsd <- fitNullModel(afr_yr4_data_reordered, 
                                  outcome = "ptsd", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = afr_grm_sparse_subsetted,
                                                 site = afr_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)

### see fixed effect results
round(lm_afr_mddprs_total$fixef,10)
round(lm_afr_mddprs_ext$fixef,10)
round(lm_afr_mddprs_int$fixef,10)
round(lm_afr_mddprs_agg$fixef,10)
round(lm_afr_mddprs_attn$fixef,10)
round(lm_afr_mddprs_anxdep$fixef,10)
round(lm_afr_mddprs_rule$fixef,10)
round(lm_afr_mddprs_social$fixef,10)
round(lm_afr_mddprs_somatic$fixef,10)
round(lm_afr_mddprs_thought$fixef,10)
round(lm_afr_mddprs_withdep$fixef,10)
round(lm_afr_mddprs_adhd$fixef,10) #18 cases, 499 controls
round(lm_afr_mddprs_anxiety$fixef,10) #46 cases, 471 controls
round(lm_afr_mddprs_mdd$fixef,10) #53 cases, 464 controls
round(lm_afr_mddprs_ptsd$fixef,10) #10 cases, 507 controls

### AIC for sex vs gender
# sex: 249 male vs 268 female
# gender: 250 cis male vs 264 cis female vs 3 gender diverse (not enough to use)

### Results
#total: no sig
#ext: no sig
#int: no sig
#agg: no sig
#attn: no sig
#anxdep: no sig
#rule: no sig
#social: no sig
#somatic: no sig
#thought: no sig
#withdep: no sig
#adhd: no sig
#anxiety: no sig
#mdd: sex: beta = 0.371, se = 0.164, p = 0.024
#ptsd: no sig



```


### Stress PRS, amadmix ancestry: cbcl or ksads ~ stress prs + sex + age + ancestry PCs

``` {stress PRS, amadmix ancestry: cbcl or ksads ~ stress prs + sex + age + ancestry PCs, r}

lm_amadmix_stressprs_total <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_total", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_ext <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_ext", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_int <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_int", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_agg <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_agg", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_attn <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_attn", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_anxdep <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_anxdep", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_rule <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_rule", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_social <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_social", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_somatic <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_somatic", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_thought <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_thought", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_stressprs_withdep <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_withdep", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)

lm_amadmix_stressprs_adhd <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "adhd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_amadmix_stressprs_anxiety <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "anxiety", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_amadmix_stressprs_mdd <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "mdd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_amadmix_stressprs_ptsd <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "ptsd", 
                                  covars = c("Zprs_stress_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)

### see fixed effect results
round(lm_amadmix_stressprs_total$fixef,10)
round(lm_amadmix_stressprs_ext$fixef,10)
round(lm_amadmix_stressprs_int$fixef,10)
round(lm_amadmix_stressprs_agg$fixef,10)
round(lm_amadmix_stressprs_attn$fixef,10)
round(lm_amadmix_stressprs_anxdep$fixef,10)
round(lm_amadmix_stressprs_rule$fixef,10)
round(lm_amadmix_stressprs_social$fixef,10)
round(lm_amadmix_stressprs_somatic$fixef,10)
round(lm_amadmix_stressprs_thought$fixef,10)
round(lm_amadmix_stressprs_withdep$fixef,10)
round(lm_amadmix_stressprs_adhd$fixef,10) #14 cases, 477 controls
round(lm_amadmix_stressprs_anxiety$fixef,10) #56 cases, 435 controls
round(lm_amadmix_stressprs_mdd$fixef,10) #50 cases, 441 controls
round(lm_amadmix_stressprs_ptsd$fixef,10) #11 cases, 480 controls

### AIC for sex vs gender
# sex: 279 male vs 212 female
# gender: 282 cis male vs 204 cis female vs 5 gender diverse (not enough to use)

### Results
#***total: prs: beta = -1.309, se = 0.577, p = 0.023
#ext: no sig
#int: sex: beta = 1.120, se = 0.497, p = 0.024
#agg: no sig
#attn: no sig
#anxdep: sex: beta = 0.538, se = 0.251, p = 0.032
#rule: no sig
#social: no sig
#somatic: sex: beta = 0.633, se = 0.268, p = 0.018
#thought: no sig
#***withdep: prs: beta = -0.670, se = 0.302, p = 0.026
#adhd: sex: beta = -0.813, se = 0.407, p = 0.046
#anxiety: sex: beta = 0.509, se = 0.161, p = 0.00151
#mdd: sex: beta = 0.560, se = 0.168, p = 0.000869; age: beta = 0.991, se = 0.363, p = 0.00630
#ptsd: no sig

### adjusted p-values for prs only
p.adjust(c(
           # lm_amadmix_stressprs_total$fixef$pval[2], #not sig
           # lm_amadmix_stressprs_ext$fixef$pval[2], #not sig
           # lm_amadmix_stressprs_int$fixef$pval[2], #not sig
           lm_amadmix_stressprs_agg$fixef$pval[2], #not sig
           lm_amadmix_stressprs_attn$fixef$pval[2], #not sig
           lm_amadmix_stressprs_anxdep$fixef$pval[2], #not sig
           lm_amadmix_stressprs_rule$fixef$pval[2], #not sig
           lm_amadmix_stressprs_social$fixef$pval[2], #not sig
           lm_amadmix_stressprs_somatic$fixef$pval[2], #not sig
           lm_amadmix_stressprs_thought$fixef$pval[2], #not sig
           lm_amadmix_stressprs_withdep$fixef$pval[2], #not sig
           lm_amadmix_stressprs_adhd$fixef$pval[2], #not sig
           lm_amadmix_stressprs_anxiety$fixef$pval[2], #not sig
           lm_amadmix_stressprs_mdd$fixef$pval[2], #not sig
           lm_amadmix_stressprs_ptsd$fixef$pval[2]), #not sig
           method="fdr")

### adjusted p-values for sex only
p.adjust(c(
           # lm_amadmix_stressprs_total$fixef$pval[3], #not sig
           # lm_amadmix_stressprs_ext$fixef$pval[3], #not sig
           # lm_amadmix_stressprs_int$fixef$pval[3], #not sig
           lm_amadmix_stressprs_agg$fixef$pval[3], #not sig
           lm_amadmix_stressprs_attn$fixef$pval[3], #not sig
           lm_amadmix_stressprs_anxdep$fixef$pval[3], #not sig
           lm_amadmix_stressprs_rule$fixef$pval[3], #not sig
           lm_amadmix_stressprs_social$fixef$pval[3], #not sig
           lm_amadmix_stressprs_somatic$fixef$pval[3], #not sig
           lm_amadmix_stressprs_thought$fixef$pval[3], #not sig
           lm_amadmix_stressprs_withdep$fixef$pval[3], #not sig
           lm_amadmix_stressprs_adhd$fixef$pval[3], #not sig
           lm_amadmix_stressprs_anxiety$fixef$pval[3], #***sig
           lm_amadmix_stressprs_mdd$fixef$pval[3], #***sig
           lm_amadmix_stressprs_ptsd$fixef$pval[3]), #not sig
           method="fdr")


### adjusted p-values for age only
p.adjust(c(
           # lm_amadmix_stressprs_total$fixef$pval[4], #not sig
           # lm_amadmix_stressprs_ext$fixef$pval[4], #not sig
           # lm_amadmix_stressprs_int$fixef$pval[4], #not sig
           lm_amadmix_stressprs_agg$fixef$pval[4], #not sig
           lm_amadmix_stressprs_attn$fixef$pval[4], #not sig
           lm_amadmix_stressprs_anxdep$fixef$pval[4], #not sig
           lm_amadmix_stressprs_rule$fixef$pval[4], #not sig
           lm_amadmix_stressprs_social$fixef$pval[4], #not sig
           lm_amadmix_stressprs_somatic$fixef$pval[4], #not sig
           lm_amadmix_stressprs_thought$fixef$pval[4], #not sig
           lm_amadmix_stressprs_withdep$fixef$pval[4], #not sig
           lm_amadmix_stressprs_adhd$fixef$pval[4], #not sig
           lm_amadmix_stressprs_anxiety$fixef$pval[4], #not sig
           lm_amadmix_stressprs_mdd$fixef$pval[4], #not sig
           lm_amadmix_stressprs_ptsd$fixef$pval[4]), #not sig
           method="fdr")

```


### MDD PRS, amadmix ancestry: cbcl or ksads ~ mdd prs + sex + age + ancestry PCs

``` {mdd PRS, amadmix ancestry: cbcl or ksads ~ mdd prs + sex + age + ancestry PCs, r}

lm_amadmix_mddprs_total <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_total", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_ext <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_ext", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_int <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_int", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_agg <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_agg", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_attn <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_attn", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_anxdep <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_anxdep", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_rule <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_rule", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_social <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_social", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_somatic <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_somatic", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_thought <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_thought", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)
lm_amadmix_mddprs_withdep <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "cbcl_withdep", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "gaussian",
                                  verbose = TRUE)

lm_amadmix_mddprs_adhd <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "adhd", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
lm_amadmix_mddprs_anxiety <- fitNullModel(amadmix_yr4_data_reordered, 
                                  outcome = "anxiety", 
                                  covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
                                  cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
                                                 site = amadmix_site_covmat),
                                  family = "binomial",
                                  verbose = TRUE)
# lm_amadmix_mddprs_mdd <- fitNullModel(amadmix_yr4_data_reordered, #did not converge
#                                   outcome = "mdd", 
#                                   covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
#                                   cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
#                                                  site = amadmix_site_covmat),
#                                   family = "binomial",
#                                   verbose = TRUE)
# lm_amadmix_mddprs_ptsd <- fitNullModel(amadmix_yr4_data_reordered, #did not converge
#                                   outcome = "ptsd", 
#                                   covars = c("Zprs_mdd_cmc", "sex_cmc_cisf", "age_zcmc", paste0("V", 1:8)),
#                                   cov.mat = list(kinship = amadmix_grm_sparse_subsetted,
#                                                  site = amadmix_site_covmat),
#                                   family = "binomial",
#                                   verbose = TRUE)

### see fixed effect results
round(lm_amadmix_mddprs_total$fixef,10)
round(lm_amadmix_mddprs_ext$fixef,10)
round(lm_amadmix_mddprs_int$fixef,10)
round(lm_amadmix_mddprs_agg$fixef,10)
round(lm_amadmix_mddprs_attn$fixef,10)
round(lm_amadmix_mddprs_anxdep$fixef,10)
round(lm_amadmix_mddprs_rule$fixef,10)
round(lm_amadmix_mddprs_social$fixef,10)
round(lm_amadmix_mddprs_somatic$fixef,10)
round(lm_amadmix_mddprs_thought$fixef,10)
round(lm_amadmix_mddprs_withdep$fixef,10)
round(lm_amadmix_mddprs_adhd$fixef,10) #14 cases, 477 controls
round(lm_amadmix_mddprs_anxiety$fixef,10) #56 cases, 435 controls
# round(lm_amadmix_mddprs_mdd$fixef,10) #50 cases, 441 controls
# round(lm_amadmix_mddprs_ptsd$fixef,10) #11 cases, 480 controls

### AIC for sex vs gender
# sex: 279 male vs 212 female
# gender: 282 cis male vs 204 cis female vs 5 gender diverse (not enough to use)

### Results
#total: no sig
#ext: no sig
#int: sex: beta = 1.148, se = 0.499, p = 0.022
#agg: no sig
#attn: no sig
#anxdep: sex: beta = 0.559, se = 0.251, p = 0.026
#rule: no sig
#social: no sig
#somatic: sex: beta = 0.625, se = 0.269, p = 0.020
#thought: no sig
#withdep: no sig
#adhd: sex: beta = -0.815, se = 0.408, p = 0.046
#anxiety: sex: beta = 0.505, se = 0.160, p = 0.00157
#mdd: did not converge
#ptsd: did not converge



```


