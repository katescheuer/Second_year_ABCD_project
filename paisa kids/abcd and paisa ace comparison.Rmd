
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

setwd("C:/Users/Kate Scheuer/OneDrive - UW/Desktop/Lab/Second_year_ABCD_project/paisa kids")
```

```{import libraries, include=FALSE}
library(tidyverse)
```

```{load data, include=FALSE}

meta <- read.csv("abcd_y_lt.csv",header=TRUE)
ksads_ptsd_parent <- read.csv("mh_p_ksads_ptsd.csv",header=TRUE)
ksads_background_parent <- read.csv("mh_p_ksads_bg.csv",header=TRUE)
life_events_parent <- read.csv("mh_p_le.csv",header=TRUE)
life_events_youth <- read.csv("mh_y_le.csv",header=TRUE)
family_environment_parent <- read.csv("ce_p_fes.csv",header=TRUE)
family_environment_youth <- read.csv("ce_y_fes.csv",header=TRUE)
discrimination_youth <- read.csv("ce_y_dm.csv",header=TRUE)

```

```{combine data, include=FALSE}

data_raw <- meta %>%
            select(c("src_subject_id","eventname","interview_age")) %>%
            left_join(ksads_ptsd_parent,by=c("src_subject_id","eventname")) %>%
            left_join(select(ksads_background_parent,
                             c("src_subject_id","eventname","kbi_p_c_bully")),
                      by=c("src_subject_id","eventname")) %>%
            left_join(select(life_events_parent,
                             c("src_subject_id","eventname",
                               "ple_separ_p","ple_separ_past_yr_p",
                               "ple_jail_p","ple_jail_past_yr_p",
                               "ple_mh_p","ple_mh_past_yr_p",
                               "ple_homeless_p","ple_homeless_past_yr_p",
                               "ple_victim_p","ple_victim_past_yr_p",
                               "ple_sud_p","ple_sud_past_yr_p",
                               "ple_foster_care_p","ple_foster_care_past_yr_p",
                               "ple_died_p","ple_died_past_yr_p",
                               "ple_deported_p","ple_deported_past_yr_p",
                               "ple_ill_p","ple_ill_past_yr_p",
                               "ple_shot_p","ple_shot_past_yr_p",
                               "ple_hit_p","ple_hit_past_yr_p",
                               "ple_lockdown_p","ple_lockdown_past_yr_p",
                               "ple_argue_p","ple_argue_past_yr_p"
                               )
                               ),
                      by=c("src_subject_id","eventname")) %>%
            left_join(select(life_events_youth,
                             c("src_subject_id","eventname",
                               "ple_separ_y","ple_separ_past_yr_y",
                               "ple_jail_y","ple_jail_past_yr_y",
                               "ple_mh_y","ple_mh_past_yr_y",
                               "ple_suicide_y","ple_suicide_past_yr_y",
                               "ple_who_y___1",
                               "ple_homeless_y","ple_homeless_past_yr_y",
                               "ple_victim_y","ple_victim_past_yr_y",
                               "ple_sud_y","ple_sud_past_yr_y",
                               "ple_foster_care_y","ple_foster_care_past_yr_y",
                               "ple_died_y","ple_died_past_yr_y",
                               "ple_deported_y","ple_deported_past_yr_y",
                               "ple_ill_y","ple_ill_past_yr_y",
                               "ple_shot_y","ple_shot_past_yr_y",
                               "ple_hit_y","ple_hit_past_yr_y",
                               "ple_lockdown_y","ple_lockdown_past_yr_y",
                               "ple_argue_y","ple_argue_past_yr_y"
                               )
                               ),
                      by=c("src_subject_id","eventname")) %>%
            left_join(select(family_environment_parent,
                             c("src_subject_id","eventname",
                               "fam_enviro6_p","fam_enviro4r_p","fes_29r_p")),
                      by=c("src_subject_id","eventname")) %>%
            left_join(select(family_environment_youth,
                             c("src_subject_id","eventname",
                               "fes_youth_q6","fes_youth_q4")),
                      by=c("src_subject_id","eventname")) %>%
            left_join(select(discrimination_youth,
                             c("src_subject_id","eventname",
                               "dim_yesno_q1","dim_yesno_q2",
                               "dim_yesno_q3","dim_yesno_q4",
                               "dim_matrix_q1","dim_matrix_q2","dim_matrix_q3")),
                      by=c("src_subject_id","eventname"))

### divide separate temporarily into year 4 and baseline/year 1
data_base_raw <- data_raw %>% filter(eventname == "baseline_year_1_arm_1")
data_yr1_raw <- data_raw %>% filter(eventname == "1_year_follow_up_y_arm_1")
data_yr4_raw <- data_raw %>% filter(eventname == "4_year_follow_up_y_arm_1")

### make adverse event columns for year 4 data
data_yr4 <- data_yr4_raw %>%
          mutate(sep_divorce = case_when(
          # at yr 4 parent says event occurred ever
          ple_separ_p==1 ~ 1,
          # at yr 1 youth says event occurred ever
          ple_separ_y==1 ~ 1,
          # at yr 1 parent says never happened
          ple_separ_p==0 ~ 0,
          # at yr 1 youth says never happened
          ple_separ_y==0 ~ 0,
          # at yr 1 question not asked to parent
          is.na(ple_separ_p) ~ NA,
          # at yr 1 question not asked to youth
          is.na(ple_separ_p) ~ NA
        )) %>%
          mutate(family_jail = case_when(
          ple_jail_p==1 ~ 1,ple_jail_y==1 ~ 1,
          ple_jail_p==0 ~ 0,ple_jail_y==0 ~ 0,
          is.na(ple_jail_p) ~ NA,is.na(ple_jail_y) ~ NA
        )) %>%
          mutate(family_mental_ill = case_when(
          ple_mh_p==1 ~ 1,ple_mh_y==1 ~ 1,
          # youth said family member died by suicide but not in the last year
          ple_suicide_y==1 & ple_who_y___1==1 ~ 1,
          ple_mh_p==0 ~ 0,ple_mh_y==0 ~ 0,
          ple_suicide_y==0 ~ 0,
          is.na(ple_mh_p) ~ NA,is.na(ple_mh_y) ~ NA,
          is.na(ple_suicide_y) ~ NA
        )) %>%
          mutate(homeless = case_when(
          ple_homeless_p==1 ~ 1,ple_homeless_y==1 ~ 1,
          ple_homeless_p==0 ~ 0,ple_homeless_y==0 ~ 0,
          is.na(ple_homeless_p) ~ NA,is.na(ple_homeless_y) ~ NA
        )) %>%
          mutate(physical_harm = case_when(
          ple_victim_p==1 ~ 1,ple_victim_y==1 ~ 1,
          ple_victim_p==0 ~ 0,ple_victim_y==0 ~ 0,
          is.na(ple_victim_p) ~ NA,is.na(ple_victim_y) ~ NA
        )) %>%
          mutate(family_sud = case_when(
          ple_sud_p==1 ~ 1,ple_sud_y==1 ~ 1,
          ple_sud_p==0 ~ 0,ple_sud_y==0 ~ 0,
          is.na(ple_sud_p) ~ NA,is.na(ple_sud_y) ~ NA
        )) %>%
          mutate(foster = case_when(
          ple_foster_care_p==1 ~ 1,ple_foster_care_y==1 ~ 1,
          ple_foster_care_p==0 ~ 0,ple_foster_care_y==0 ~ 0,
          is.na(ple_foster_care_p) ~ NA,is.na(ple_foster_care_y) ~ NA
        )) %>%
          mutate(family_died = case_when(
          ple_died_p==1 ~ 1,ple_died_y==1 ~ 1,
          ple_died_p==0 ~ 0,ple_died_y==0 ~ 0,
          is.na(ple_died_p) ~ NA,is.na(ple_died_y) ~ NA
        )) %>%
          mutate(deportation = case_when(
          ple_deported_p==1 ~ 1,ple_deported_y==1 ~ 1,
          ple_deported_p==0 ~ 0,ple_deported_y==0 ~ 0,
          is.na(ple_deported_p) ~ NA,is.na(ple_deported_y) ~ NA
        )) %>%
          mutate(sick = case_when(
          ple_ill_p==1 ~ 1,ple_ill_y==1 ~ 1,
          ple_ill_p==0 ~ 0,ple_ill_y==0 ~ 0,
          is.na(ple_ill_p) ~ NA,is.na(ple_ill_y) ~ NA
        )) %>%
          mutate(neighborhood_violence = case_when(
          ple_shot_p==1 ~ 1,ple_shot_y==1 ~ 1,
          ple_hit_p==1 ~ 1,ple_hit_y==1 ~ 1,
          ple_lockdown_p==1 ~ 1,ple_lockdown_y==1 ~ 1,
          ple_shot_p==0 ~ 0,ple_shot_y==0 ~ 0,
          ple_hit_p==0 ~ 0,ple_hit_y==0 ~ 0,
          ple_lockdown_p==0 ~ 0,ple_lockdown_y==0 ~ 0,
          is.na(ple_shot_p) ~ NA,is.na(ple_shot_y) ~ NA,
          is.na(ple_hit_p) ~ NA,is.na(ple_hit_y) ~ NA,
          is.na(ple_lockdown_p) ~ NA,is.na(ple_lockdown_y) ~ NA
        )) %>%
          mutate(parent_relationship = case_when(
          ple_argue_p==1 ~ 1,ple_argue_y==1 ~ 1,
          ple_argue_p==0 ~ 0,ple_argue_y==0 ~ 0,
          is.na(ple_argue_p) ~ NA,is.na(ple_argue_y) ~ NA
        ))

### calculate baseline life event columns
data_yr1 <- data_yr1_raw %>%
          mutate(sep_divorce_base = case_when(
          # at yr 1 parent says event occurred ever but not past yr (so baseline)
          ple_separ_p==1 & ple_separ_past_yr_p==0 ~ 1,
          # at yr 1 youth says event occurred ever but not past yr (so baseline)
          ple_separ_y==1 & ple_separ_past_yr_y==0 ~ 1,
          # at yr 1 parent says never happened
          ple_separ_p==0 ~ 0,
          # at yr 1 youth says never happened
          ple_separ_y==0 ~ 0,
          # at yr 1 question not asked to parent
          is.na(ple_separ_p) ~ NA,
          # at yr 1 question not asked to youth
          is.na(ple_separ_p) ~ NA
        )) %>%
          mutate(family_jail_base = case_when(
          ple_jail_p==1 & ple_jail_past_yr_p==0 ~ 1,
          ple_jail_y==1 & ple_jail_past_yr_y==0 ~ 1,
          ple_jail_p==0 ~ 0,
          ple_jail_y==0 ~ 0,
          is.na(ple_jail_p) ~ NA,
          is.na(ple_jail_y) ~ NA
        )) %>%
          mutate(family_mental_ill_base = case_when(
          ple_mh_p==1 & ple_mh_past_yr_p==0 ~ 1,
          ple_mh_y==1 & ple_mh_past_yr_y==0 ~ 1,
          # youth said family member died by suicide but not in the last year
          ple_suicide_y==1 & ple_who_y___1==1 & ple_argue_past_yr_y==0 ~ 1,
          ple_mh_p==0 ~ 0,
          ple_mh_y==0 ~ 0,
          ple_suicide_y==0 ~ 0,
          is.na(ple_mh_p) ~ NA,
          is.na(ple_mh_y) ~ NA,
          is.na(ple_suicide_y) ~ NA
        )) %>%
          mutate(homeless_base = case_when(
          ple_homeless_p==1 & ple_homeless_past_yr_p==0 ~ 1,
          ple_homeless_y==1 & ple_homeless_past_yr_y==0 ~ 1,
          ple_homeless_p==0 ~ 0,
          ple_homeless_y==0 ~ 0,
          is.na(ple_homeless_p) ~ NA,
          is.na(ple_homeless_y) ~ NA
        )) %>%
          mutate(physical_harm_base = case_when(
          ple_victim_p==1 & ple_victim_past_yr_p==0 ~ 1,
          ple_victim_y==1 & ple_victim_past_yr_y==0 ~ 1,
          ple_victim_p==0 ~ 0,
          ple_victim_y==0 ~ 0,
          is.na(ple_victim_p) ~ NA,
          is.na(ple_victim_y) ~ NA
        )) %>%
          mutate(family_sud_base = case_when(
          ple_sud_p==1 & ple_sud_past_yr_p==0 ~ 1,
          ple_sud_y==1 & ple_sud_past_yr_y==0 ~ 1,
          ple_sud_p==0 ~ 0,
          ple_sud_y==0 ~ 0,
          is.na(ple_sud_p) ~ NA,
          is.na(ple_sud_y) ~ NA
        )) %>%
          mutate(foster_base = case_when(
          ple_foster_care_p==1 & ple_foster_care_past_yr_p==0 ~ 1,
          ple_foster_care_y==1 & ple_foster_care_past_yr_y==0 ~ 1,
          ple_foster_care_p==0 ~ 0,
          ple_foster_care_y==0 ~ 0,
          is.na(ple_foster_care_p) ~ NA,
          is.na(ple_foster_care_y) ~ NA
        )) %>%
          mutate(family_died_base = case_when(
          ple_died_p==1 & ple_died_past_yr_p==0 ~ 1,
          ple_died_y==1 & ple_died_past_yr_y==0 ~ 1,
          ple_died_p==0 ~ 0,
          ple_died_y==0 ~ 0,
          is.na(ple_died_p) ~ NA,
          is.na(ple_died_y) ~ NA
        )) %>%
          mutate(deportation_base = case_when(
          ple_deported_p==1 & ple_deported_past_yr_p==0 ~ 1,
          ple_deported_y==1 & ple_deported_past_yr_y==0 ~ 1,
          ple_deported_p==0 ~ 0,
          ple_deported_y==0 ~ 0,
          is.na(ple_deported_p) ~ NA,
          is.na(ple_deported_y) ~ NA
        )) %>%
          mutate(sick_base = case_when(
          ple_ill_p==1 & ple_ill_past_yr_p==0 ~ 1,
          ple_ill_y==1 & ple_ill_past_yr_y==0 ~ 1,
          ple_ill_p==0 ~ 0,
          ple_ill_y==0 ~ 0,
          is.na(ple_ill_p) ~ NA,
          is.na(ple_ill_y) ~ NA
        )) %>%
          mutate(neighborhood_violence_base = case_when(
          ple_shot_p==1 & ple_shot_past_yr_p==0 ~ 1,
          ple_shot_y==1 & ple_shot_past_yr_y==0 ~ 1,
          ple_hit_p==1 & ple_hit_past_yr_p==0 ~ 1,
          ple_hit_y==1 & ple_hit_past_yr_y==0 ~ 1,
          ple_lockdown_p==1 & ple_lockdown_past_yr_p==0 ~ 1,
          ple_lockdown_y==1 & ple_lockdown_past_yr_y==0 ~ 1,
          ple_shot_p==0 ~ 0,
          ple_shot_y==0 ~ 0,
          ple_hit_p==0 ~ 0,
          ple_hit_y==0 ~ 0,
          ple_lockdown_p==0 ~ 0,
          ple_lockdown_y==0 ~ 0,
          is.na(ple_shot_p) ~ NA,
          is.na(ple_shot_y) ~ NA,
          is.na(ple_hit_p) ~ NA,
          is.na(ple_hit_y) ~ NA,
          is.na(ple_lockdown_p) ~ NA,
          is.na(ple_lockdown_y) ~ NA
        )) %>%
          mutate(parent_relationship_base = case_when(
          ple_argue_p==1 & ple_argue_past_yr_p==0 ~ 1,
          ple_argue_y==1 & ple_argue_past_yr_y==0 ~ 1,
          ple_argue_p==0 ~ 0,
          ple_argue_y==0 ~ 0,
          is.na(ple_argue_p) ~ NA,
          is.na(ple_argue_y) ~ NA
        ))

# add baseline line event columns to baseline data frame
data_base_with_le <- data_base_raw %>% 
          left_join(select(data_yr1,c("src_subject_id",
                                      "sep_divorce_base",
                                      "family_jail_base",
                                      "family_mental_ill_base",
                                      "homeless_base",
                                      "physical_harm_base",
                                      "family_sud_base","foster_base",
                                      "family_died_base","deportation_base",
                                      "sick_base",
                                      "neighborhood_violence_base",
                                      "parent_relationship_base")
                            ),
                    by=c("src_subject_id")) %>%
          rename(sep_divorce = sep_divorce_base,
                 family_jail = family_jail_base,
                 family_mental_ill = family_mental_ill_base,
                 homeless = homeless_base,
                 physical_harm = physical_harm_base,
                 family_sud = family_sud_base,
                 foster = foster_base,
                 family_died = family_died_base,
                 deportation = deportation_base,
                 sick = sick_base,
                 neighborhood_violence = neighborhood_violence_base,
                 parent_relationship = parent_relationship_base
                 )

### keep data only from subjects who are not in year 4 data
yr4_ids <- data_yr4_raw %>% select(src_subject_id) 
baseline_ids_all <- data_base_raw %>% select(src_subject_id) 
baseline_ids_keep <- anti_join(baseline_ids_all,yr4_ids,by="src_subject_id")
data_base <- baseline_ids_keep %>% left_join(data_base_with_le,by=c("src_subject_id"))

### recombine baseline and year 4 data
data_combined <- bind_rows(data_base,data_yr4)

### select only relevant columns from combined data, rename so more understandable
data_all <- data_combined %>%
          # note: there is no data from kids 144+ months (12+ yrs) at baseline
          # make new column for younger vs older group
          mutate(age_group = case_when(eventname=="baseline_year_1_arm_1" ~ "younger",
                                       eventname=="4_year_follow_up_y_arm_1" ~ "older"
          )) %>%
          mutate(car_accident = case_when(ksads_ptsd_raw_754_p==1 ~ 1,
                                          ksads_ptsd_raw_754_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_754_p==1) ~ NA)) %>%
          mutate(other_accident = case_when(ksads_ptsd_raw_755_p==1 ~ 1,
                                          ksads_ptsd_raw_755_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_755_p==1) ~ NA)) %>%
          mutate(fire = case_when(ksads_ptsd_raw_756_p==1 ~ 1,
                                          ksads_ptsd_raw_756_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_756_p==1) ~ NA)) %>%
          mutate(natural_disaster = case_when(ksads_ptsd_raw_757_p==1 ~ 1,
                                          ksads_ptsd_raw_757_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_757_p==1) ~ NA)) %>%
          mutate(terrorism = case_when(ksads_ptsd_raw_758_p==1 ~ 1,
                                          ksads_ptsd_raw_758_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_758_p==1) ~ NA)) %>%
          mutate(war = case_when(ksads_ptsd_raw_759_p==1 ~ 1,
                                          ksads_ptsd_raw_759_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_759_p==1) ~ NA)) %>%
          mutate(witness_harm = case_when(ksads_ptsd_raw_760_p==1 ~ 1,
                                          ksads_ptsd_raw_760_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_760_p==1) ~ NA)) %>%
          mutate(non_family_harm = case_when(ksads_ptsd_raw_761_p==1 ~ 1,
                                          ksads_ptsd_raw_761_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_761_p==1) ~ NA)) %>%
          mutate(family_harm = case_when(ksads_ptsd_raw_762_p==1 ~ 1,
                                          ksads_ptsd_raw_762_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_762_p==1) ~ NA)) %>%
          mutate(beaten = case_when(ksads_ptsd_raw_763_p==1 ~ 1,
                                          ksads_ptsd_raw_763_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_763_p==1) ~ NA)) %>%
          mutate(non_family_threatened = case_when(ksads_ptsd_raw_764_p==1 ~ 1,
                                          ksads_ptsd_raw_764_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_764_p==1) ~ NA)) %>%
          mutate(family_threatened = case_when(ksads_ptsd_raw_765_p==1 ~ 1,
                                          ksads_ptsd_raw_765_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_765_p==1) ~ NA)) %>%
          mutate(adult_violence = case_when(ksads_ptsd_raw_766_p==1 ~ 1,
                                          ksads_ptsd_raw_766_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_766_p==1) ~ NA)) %>%
          mutate(family_sexual = case_when(ksads_ptsd_raw_767_p==1 ~ 1,
                                          ksads_ptsd_raw_767_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_767_p==1) ~ NA)) %>%
          mutate(adult_sexual = case_when(ksads_ptsd_raw_768_p==1 ~ 1,
                                          ksads_ptsd_raw_768_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_768_p==1) ~ NA)) %>%
          mutate(peer_sexual = case_when(ksads_ptsd_raw_769_p==1 ~ 1,
                                          ksads_ptsd_raw_769_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_769_p==1) ~ NA)) %>%
          mutate(all_sexual = case_when(ksads_ptsd_raw_767_p==1 ~ 1,
                                        ksads_ptsd_raw_768_p==1 ~ 1,
                                        ksads_ptsd_raw_769_p==1 ~ 1,
                                        ksads_ptsd_raw_767_p==0 ~ 0,
                                        ksads_ptsd_raw_768_p==0 ~ 0,
                                        ksads_ptsd_raw_769_p==0 ~ 0,
                                        is.na(ksads_ptsd_raw_767_p==1) ~ NA,
                                        is.na(ksads_ptsd_raw_768_p==1) ~ NA,
                                        is.na(ksads_ptsd_raw_769_p==1) ~ NA)) %>%
          mutate(learn_death = case_when(ksads_ptsd_raw_770_p==1 ~ 1,
                                          ksads_ptsd_raw_770_p==0 ~ 0,
                                          is.na(ksads_ptsd_raw_770_p==1) ~ NA)) %>%
          mutate(bullying = case_when(kbi_p_c_bully==1 ~ 1, #yes
                                      kbi_p_c_bully==2 ~ 0, #no
                                      is.na(kbi_p_c_bully) ~ NA)) %>%
          mutate(find_things = case_when(fes_29r_p==1 ~ 0, #originally 1 = false, not hard to find
                                         fes_29r_p==0 ~ 1, #originally 0 = true, hard to find
                                         is.na(fes_29r_p) ~ NA)) %>%
          mutate(family_hurt = case_when(fes_youth_q6==1 ~ 1,
                                         fam_enviro6_p==1 ~ 1,
                                         fes_youth_q6==0 ~ 0,
                                         fam_enviro6_p==0 ~ 0,
                                         is.na(fes_youth_q6) ~ NA,
                                         is.na(fam_enviro6_p) ~ NA)) %>%
          mutate(parent_anger = case_when(fes_youth_q4==1 ~ 1, #1 = false, do not hardly lose temper
                                          fam_enviro4r_p==1 ~ 1, #1 = false, do not hardly lose temper
                                          fes_youth_q4==0 ~ 0, #0 = true, hardly lose temper
                                          fam_enviro4r_p==0 ~ 0, #0 = true, hardly lose temper
                                          is.na(fes_youth_q4) ~ NA,
                                          is.na(fam_enviro4r_p) ~ NA)) %>%
          mutate(discrimination_last_year = case_when(dim_yesno_q1==1 ~ 1,
                                                      dim_yesno_q1==2 ~ 1,
                                                      dim_yesno_q1==3 ~ 1,
                                                      dim_yesno_q1==4 ~ 1,
                                                      dim_yesno_q1==0 ~ 0,
                                                      dim_yesno_q2==0 ~ 0,
                                                      dim_yesno_q3==0 ~ 0,
                                                      dim_yesno_q4==0 ~ 0,
                                                      is.na(dim_yesno_q1) ~ NA,
                                                      is.na(dim_yesno_q2) ~ NA,
                                                      is.na(dim_yesno_q3) ~ NA,
                                                      is.na(dim_yesno_q4) ~ NA
                                                      )) %>%
          mutate(discrimination_often = case_when(dim_matrix_q1==4 ~ 1, #often
                                            dim_matrix_q1==5 ~ 1, #very often
                                            dim_matrix_q2==4 ~ 1, #often
                                            dim_matrix_q2==5 ~ 1, #very often
                                            dim_matrix_q3==4 ~ 1, #often
                                            dim_matrix_q3==5 ~ 1, #very often
                                            dim_matrix_q1==1 ~ 0, #almost never
                                            dim_matrix_q1==2 ~ 0, #rarely
                                            dim_matrix_q1==3 ~ 0, #sometimes
                                            dim_matrix_q2==1 ~ 0, #almost never
                                            dim_matrix_q2==2 ~ 0, #rarely
                                            dim_matrix_q2==3 ~ 0, #sometimes
                                            dim_matrix_q3==1 ~ 0, #almost never
                                            dim_matrix_q3==2 ~ 0, #rarely
                                            dim_matrix_q3==3 ~ 0, #sometimes
                                            dim_matrix_q1==777 ~ NA, #don't know
                                            dim_matrix_q1==777 ~ NA, #don't know
                                            dim_matrix_q2==777 ~ NA, #don't know
                                            dim_matrix_q2==777 ~ NA, #don't know
                                            dim_matrix_q3==777 ~ NA, #don't know
                                            dim_matrix_q3==777 ~ NA, #refuse to answer
                                            dim_matrix_q1==999 ~ NA, #refuse to answer
                                            dim_matrix_q1==999 ~ NA, #refuse to answer
                                            dim_matrix_q2==999 ~ NA, #refuse to answer
                                            dim_matrix_q2==999 ~ NA, #refuse to answer
                                            dim_matrix_q3==999 ~ NA, #refuse to answer
                                            dim_matrix_q3==999 ~ NA, #refuse to answer
                                            is.na(dim_matrix_q1) ~ NA,
                                            is.na(dim_matrix_q2) ~ NA,
                                            is.na(dim_matrix_q3) ~ NA,
                                            )) %>%
          mutate(any_ksads_comp_q = case_when(car_accident==1 ~ 1,
                                              other_accident==1 ~ 1,
                                              fire==1 ~ 1,
                                              natural_disaster==1 ~ 1,
                                              terrorism==1 ~ 1,
                                              war==1 ~ 1,
                                              witness_harm==1 ~ 1,
                                              non_family_harm==1 ~ 1,
                                              beaten==1 ~ 1,
                                              adult_violence==1 ~ 1,
                                              peer_sexual==1 ~ 1,
                                              learn_death==1 ~ 1,
                                              physical_harm==1 ~ 1,
                                              adult_sexual==1 ~ 1,
                                              discrimination_last_year==1 ~ 1,
                                              all_sexual==1 ~ 1,
                                              TRUE ~ 0
                                              )) %>%
          mutate(any_aces_q = case_when(sep_divorce==1 ~ 1,
                                              family_jail==1 ~ 1,
                                              family_mental_ill==1 ~ 1,
                                              family_hurt==1 ~ 1,
                                              homeless==1 ~ 1,
                                              physical_harm==1 ~ 1,
                                              family_sud==1 ~ 1,
                                              foster==1 ~ 1,
                                              bullying==1 ~ 1,
                                              family_died==1 ~ 1,
                                              deportation==1 ~ 1,
                                              sick==1 ~ 1,
                                              neighborhood_violence==1 ~ 1,
                                              discrimination_often==1 ~ 1,                              
                                              TRUE ~ 0
                                              )) %>%
          select(c("src_subject_id","eventname","age_group",
                   ### paisa ksads-comp analogues
                   "car_accident","other_accident","fire",
                   "natural_disaster","terrorism","war",
                   "witness_harm","non_family_harm",
                   "beaten","adult_violence","peer_sexual",
                   "learn_death","physical_harm","adult_sexual",
                   "discrimination_last_year","all_sexual",
                   "any_ksads_comp_q",
                   ### paisa ace-q analogues
                   "sep_divorce","family_jail","family_mental_ill",
                   "family_hurt","homeless","physical_harm",
                   "family_sud","foster","bullying",
                   "family_died","deportation","sick",
                   "neighborhood_violence","discrimination_often",
                   "any_aces_q",
                   ### paisa quic analogues
                   "parent_anger","parent_relationship","find_things"
                   ))

```

```{determine prevalence of each ace, include=FALSE}
data_all$age_group <- as.factor(data_all$age_group)
nrow(data_all) #11868 subjects total
data_all %>% 
  select(-c(src_subject_id)) %>%
  map(table)
data_all %>% 
  select(-c(src_subject_id)) %>%
  filter(eventname=="baseline_year_1_arm_1") %>%
  map(table)
data_all %>% 
  select(-c(src_subject_id)) %>%
  filter(eventname=="4_year_follow_up_y_arm_1") %>%
  map(table)

```
